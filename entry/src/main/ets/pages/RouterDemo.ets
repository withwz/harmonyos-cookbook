import router from '@ohos.router'

/**
 * é¡µé¢è·¯ç”±ä¸ç”Ÿå‘½å‘¨æœŸæ¼”ç¤º
 *
 * æ¶µç›–ï¼š
 * - é¡µé¢è·³è½¬æ–¹å¼
 * - å‚æ•°ä¼ é€’
 * - ç”Ÿå‘½å‘¨æœŸé’©å­
 */

interface RouteItem {
  title: string
  route: string
  description: string
  color: string
}

@Entry
@Component
struct RouterDemo {
  @State lifecycleLog: Array<string> = []

  build() {
    Column() {
      // æ ‡é¢˜
      Text('é¡µé¢è·¯ç”±ä¸ç”Ÿå‘½å‘¨æœŸ')
        .fontSize(28)
        .fontWeight(FontWeight.Bold)
        .margin({ top: 20, bottom: 10 })

      Text('å­¦ä¹ é¡µé¢è·³è½¬ã€å‚æ•°ä¼ é€’ã€ç”Ÿå‘½å‘¨æœŸ')
        .fontSize(14)
        .fontColor('#666666')
        .margin({ bottom: 20 })

      // ç”Ÿå‘½å‘¨æœŸæ—¥å¿—
      Column({ space: 8 }) {
        Row() {
          Text('ç”Ÿå‘½å‘¨æœŸæ—¥å¿—')
            .fontSize(16)
            .fontWeight(FontWeight.Medium)

          Button('æ¸…ç©º')
            .fontSize(12)
            .onClick(() => {
              this.lifecycleLog = []
            })
        }
        .width('100%')

        List({ space: 4 }) {
          ForEach(this.lifecycleLog, (log: string) => {
            ListItem() {
              Text(log)
                .fontSize(12)
                .fontColor('#666')
            }
          }, (log: string) => log)
        }
        .width('100%')
        .height(150)
        .padding(8)
        .backgroundColor('#F8F8F8')
        .borderRadius(8)
      }
      .width('100%')
      .padding({ left: 16, right: 16 })
      .layoutWeight(1)

      // è·¯ç”±æ¼”ç¤ºåˆ—è¡¨
      Column({ space: 12 }) {
        Text('è·¯ç”±æ¼”ç¤º')
          .fontSize(16)
          .fontWeight(FontWeight.Medium)
          .width('100%')
          .padding({ left: 16, right: 16 })
          .margin({ bottom: 8 })

        this.RouteButton(
          'åŸºç¡€è·³è½¬ (pushUrl)',
          'æœ€ç®€å•çš„é¡µé¢è·³è½¬æ–¹å¼',
          '#007DFF',
          () => {
            router.pushUrl({
              url: 'pages/RouterTargetPage'
            })
          }
        )

        this.RouteButton(
          'å¸¦å‚æ•°è·³è½¬',
          'è·³è½¬æ—¶ä¼ é€’å‚æ•°åˆ°ç›®æ ‡é¡µé¢',
          '#52C41A',
          () => {
            router.pushUrl({
              url: 'pages/RouterTargetPage',
              params: {
                from: 'RouterDemo',
                message: 'ä½ å¥½ï¼Œç›®æ ‡é¡µé¢ï¼',
                timestamp: Date.now()
              }
            })
          }
        )

        this.RouteButton(
          'Router.replaceUrl',
          'æ›¿æ¢å½“å‰é¡µé¢ï¼Œæ— æ³•è¿”å›',
          '#FF6B6B',
          () => {
            router.replaceUrl({
              url: 'pages/RouterTargetPage',
              params: {
                from: 'RouterDemo (replaceUrl)',
                message: 'å½“å‰é¡µé¢è¢«æ›¿æ¢'
              }
            })
          }
        )

        this.RouteButton(
          'Router.back()',
          'è¿”å›ä¸Šä¸€é¡µ',
          '#722ED1',
          () => {
            router.back()
          }
        )

        this.RouteButton(
          'Router.back() å¸¦å‚æ•°',
          'è¿”å›ä¸Šä¸€é¡µå¹¶ä¼ é€’æ•°æ®',
          '#FA8C16',
          () => {
            router.back({
              url: 'pages/Index',
              params: {
                result: 'ä»RouterDemoè¿”å›çš„æ•°æ®'
              }
            })
          }
        )
      }
      .width('100%')
      .padding({ left: 16, right: 16, bottom: 20 })
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#F5F5F5')
  }

  @Builder
  RouteButton(title: string, desc: string, color: string, onClick: () => void) {
    Column({ space: 4 }) {
      Text(title)
        .fontSize(16)
        .fontWeight(FontWeight.Medium)

      Text(desc)
        .fontSize(12)
        .fontColor('#666')
    }
    .alignItems(HorizontalAlign.Start)
    .width('100%')
    .padding(16)
    .backgroundColor(Color.White)
    .borderRadius(12)
    .border({ width: 4, color: color })
    .onClick(onClick)
  }

  // æ·»åŠ æ—¥å¿—
  private addLog(message: string) {
    const time = new Date().toLocaleTimeString()
    this.lifecycleLog.unshift(`[${time}] ${message}`)
    if (this.lifecycleLog.length > 50) {
      this.lifecycleLog = this.lifecycleLog.slice(0, 50)
    }
  }

  // ==================== ç”Ÿå‘½å‘¨æœŸé’©å­ ====================
  aboutToAppear() {
    this.addLog('âœ… aboutToAppear - é¡µé¢å³å°†å‡ºç°')
  }

  aboutToDisappear() {
    this.addLog('âŒ aboutToDisappear - é¡µé¢å³å°†æ¶ˆå¤±')
  }

  onPageShow() {
    this.addLog('ğŸ‘ï¸ onPageShow - é¡µé¢å·²æ˜¾ç¤º')
  }

  onPageHide() {
    this.addLog('ğŸ™ˆ onPageHide - é¡µé¢å·²éšè—')
  }
}
