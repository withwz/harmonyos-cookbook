import router from '@ohos.router'

/**
 * @Builder è£…é¥°å™¨æ¼”ç¤º
 */

// å®šä¹‰æŒ‰é’®ç±»å‹
type ButtonType = 'primary' | 'success' | 'warning'

// ==================== å…¨å±€ @Builder å‡½æ•° ====================
@Builder
function StyledButton(text: string, type: ButtonType, onClick: () => void) {
  Button(text)
    .fontSize(16)
    .height(44)
    .backgroundColor(type === 'primary' ? '#007DFF' : type === 'success' ? '#52C41A' : '#FAAD14')
    .borderRadius(8)
    .width('100%')
    .onClick(onClick)
}

// å®šä¹‰ç”¨æˆ·å¡ç‰‡å‚æ•°æ¥å£
interface UserProfileParams {
  name: string
  avatar: string
  bio: string
}

// ==================== ç”¨æˆ·ä¿¡æ¯å¡ç‰‡æ„å»ºå‡½æ•° ====================
@Builder
function UserProfileCard(params: UserProfileParams) {
  Row({ space: 12 }) {
    Text(params.avatar)
      .fontSize(40)
      .width(60)
      .height(60)
      .backgroundColor('#E6E6E6')
      .borderRadius(30)
      .textAlign(TextAlign.Center)

    Column({ space: 4 }) {
      Text(params.name)
        .fontSize(18)
        .fontWeight(FontWeight.Medium)

      Text(params.bio)
        .fontSize(14)
        .fontColor('#666')
        .maxLines(2)
        .textOverflow({ overflow: TextOverflow.Ellipsis })
    }
    .alignItems(HorizontalAlign.Start)
    .layoutWeight(1)
  }
  .width('100%')
  .padding(16)
  .backgroundColor(Color.White)
  .borderRadius(12)
  .shadow({ radius: 4, color: '#1F000000', offsetX: 0, offsetY: 2 })
}

// å®šä¹‰å¾…åŠé¡¹æ¥å£
interface TodoItem {
  title: string
  done: boolean
}

// ==================== ä¸»é¡µé¢ ====================
@Entry
@Component
struct BuilderDemo {
  @State count: number = 0
  @State isLoading: boolean = false
  @State message: string = ''
  @State todoList: Array<TodoItem> = []

  aboutToAppear() {
    this.todoList = [
      { title: 'å­¦ä¹  @State', done: true },
      { title: 'å­¦ä¹  @Prop', done: true },
      { title: 'å­¦ä¹  @Link', done: true },
      { title: 'å­¦ä¹  @ObjectLink', done: false },
      { title: 'å­¦ä¹  @Builder', done: false }
    ]
  }

  build() {
    Scroll() {
      Column({ space: 20 }) {
        this.BackButton()
        this.SectionTitle('@Builder è£…é¥°å™¨æ¼”ç¤º')
        this.InfoCard('@Builder å°†é‡å¤ UI å°è£…æˆå¯å¤ç”¨çš„æ„å»ºå‡½æ•°ï¼Œæé«˜ä»£ç å¤ç”¨æ€§')

        // ç¤ºä¾‹1ï¼šå…¨å±€ @Builder
        this.GlobalBuilderSection()

        // ç¤ºä¾‹2ï¼šç»„ä»¶å†… @Builder
        this.LocalBuilderSection()

        // ç¤ºä¾‹3ï¼šå¸¦å‚æ•°çš„ @Builder
        this.ParamsBuilderSection()

        // ç¤ºä¾‹4ï¼šæ¡ä»¶æ¸²æŸ“
        this.ConditionalBuilderSection()

        // ç¤ºä¾‹5ï¼šåˆ—è¡¨é¡¹å¤ç”¨
        this.ListItemBuilderSection()

        this.BestPracticeCard()
        this.TipCard('@Builder è¦ç‚¹ï¼šå°è£…é‡å¤ UIã€æ”¯æŒå‚æ•°ã€å…¨å±€/å±€éƒ¨å®šä¹‰')
      }
      .width('100%')
      .padding({ left: 16, right: 16, top: 20, bottom: 20 })
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#F5F5F5')
  }

  @Builder
  GlobalBuilderSection() {
    Column({ space: 12 }) {
      Text('ä½¿ç”¨å…¨å±€å®šä¹‰çš„ StyledButton å‡½æ•°')
        .fontSize(14)
        .fontColor('#666')

      StyledButton('ä¸»è¦æŒ‰é’®', 'primary', () => {
        this.message = 'ç‚¹å‡»äº†ä¸»è¦æŒ‰é’®'
      })

      StyledButton('æˆåŠŸæŒ‰é’®', 'success', () => {
        this.message = 'ç‚¹å‡»äº†æˆåŠŸæŒ‰é’®'
      })

      StyledButton('è­¦å‘ŠæŒ‰é’®', 'warning', () => {
        this.message = 'ç‚¹å‡»äº†è­¦å‘ŠæŒ‰é’®'
      })

      if (this.message) {
        Text(this.message)
          .fontSize(14)
          .fontColor('#007DFF')
          .padding(8)
          .backgroundColor('#E6F7FF')
          .borderRadius(6)
      }
    }
    .width('100%')
    .padding(16)
    .backgroundColor(Color.White)
    .borderRadius(12)
    .shadow({ radius: 4, color: '#1F000000', offsetX: 0, offsetY: 2 })
  }

  @Builder
  LocalBuilderSection() {
    Column({ space: 12 }) {
      Text('ä½¿ç”¨ç»„ä»¶å†…å®šä¹‰çš„ StatCard å‡½æ•°')
        .fontSize(14)
        .fontColor('#666')

      Row({ space: 12 }) {
        this.StatCard('è®¿é—®é‡', '1,234', '#007DFF')
        this.StatCard('ç‚¹èµæ•°', '567', '#FF6B6B')
        this.StatCard('è¯„è®ºæ•°', '89', '#52C41A')
      }
      .width('100%')
    }
    .width('100%')
    .padding(16)
    .backgroundColor(Color.White)
    .borderRadius(12)
    .shadow({ radius: 4, color: '#1F000000', offsetX: 0, offsetY: 2 })
  }

  @Builder
  ParamsBuilderSection() {
    Column({ space: 12 }) {
      UserProfileCard({
        name: 'å¼ ä¸‰',
        avatar: 'ğŸ‘¤',
        bio: 'çƒ­çˆ±ç¼–ç¨‹ï¼Œå–œæ¬¢é¸¿è’™å¼€å‘'
      })

      UserProfileCard({
        name: 'æå››',
        avatar: 'ğŸ‘©',
        bio: 'UI è®¾è®¡å¸ˆï¼Œæ“…é•¿ ArkUI è®¾è®¡'
      })

      UserProfileCard({
        name: 'ç‹äº”',
        avatar: 'ğŸ§‘',
        bio: 'å…¨æ ˆå·¥ç¨‹å¸ˆï¼ŒReact Native å’Œé¸¿è’™éƒ½ä¼š'
      })
    }
    .width('100%')
    .padding(16)
    .backgroundColor(Color.White)
    .borderRadius(12)
    .shadow({ radius: 4, color: '#1F000000', offsetX: 0, offsetY: 2 })
  }

  @Builder
  ConditionalBuilderSection() {
    Column({ space: 12 }) {
      Row({ space: 12 }) {
        Button('åŠ è½½ä¸­')
          .onClick(() => {
            this.isLoading = true
          })

        Button('å®Œæˆ')
          .onClick(() => {
            this.isLoading = false
          })
      }

      this.StatusView()
    }
    .width('100%')
    .padding(16)
    .backgroundColor(Color.White)
    .borderRadius(12)
    .shadow({ radius: 4, color: '#1F000000', offsetX: 0, offsetY: 2 })
  }

  @Builder
  ListItemBuilderSection() {
    Column({ space: 12 }) {
      ForEach(this.todoList, (item: TodoItem) => {
        this.ListItemView(item)
      }, (item: TodoItem) => item.title)
    }
    .width('100%')
    .padding(16)
    .backgroundColor(Color.White)
    .borderRadius(12)
    .shadow({ radius: 4, color: '#1F000000', offsetX: 0, offsetY: 2 })
  }

  // ==================== ç»„ä»¶å†… @Builder å‡½æ•° ====================

  @Builder
  StatCard(label: string, value: string, color: string) {
    Column({ space: 8 }) {
      Text(label)
        .fontSize(14)
        .fontColor('#666')

      Text(value)
        .fontSize(24)
        .fontWeight(FontWeight.Bold)
        .fontColor(color)
    }
    .width('100%')
    .padding(16)
    .backgroundColor('#F8F8F8')
    .borderRadius(12)
    .layoutWeight(1)
  }

  @Builder
  StatusView() {
    if (this.isLoading) {
      Row({ space: 8 }) {
        LoadingProgress()
          .width(20)
          .height(20)
          .color('#007DFF')

        Text('åŠ è½½ä¸­...')
          .fontSize(14)
          .fontColor('#666')
      }
      .width('100%')
      .padding(16)
      .backgroundColor('#E6F7FF')
      .borderRadius(8)
    } else {
      Row() {
        Text('âœ“ åŠ è½½å®Œæˆ')
          .fontSize(14)
          .fontColor('#52C41A')
          .layoutWeight(1)

        Button('é‡æ–°åŠ è½½')
          .fontSize(12)
          .onClick(() => {
            this.isLoading = true
          })
      }
      .width('100%')
      .padding(12)
      .backgroundColor('#F6FFED')
      .borderRadius(8)
    }
  }

  @Builder
  ListItemView(item: TodoItem) {
    Row() {
      Text(item.done ? 'âœ“' : 'â—‹')
        .fontSize(20)
        .fontColor(item.done ? '#52C41A' : '#D9D9D9')
        .margin({ right: 12 })

      Text(item.title)
        .fontSize(16)
        .fontColor(item.done ? '#999' : '#333')
        .decoration({
          type: item.done ? TextDecorationType.LineThrough : TextDecorationType.None
        })
        .layoutWeight(1)
    }
    .width('100%')
    .padding(12)
    .backgroundColor(Color.White)
    .borderRadius(8)
  }

  // ==================== è¾…åŠ©æ„å»ºå‡½æ•° ====================

  @Builder
  BackButton() {
    Row() {
      Button('â† è¿”å›')
        .fontSize(14)
        .onClick(() => {
          router.back()
        })
    }
    .width('100%')
    .margin({ bottom: 10 })
  }

  @Builder
  SectionTitle(title: string) {
    Text(title)
      .fontSize(24)
      .fontWeight(FontWeight.Bold)
      .width('100%')
  }

  @Builder
  InfoCard(info: string) {
    Text(info)
      .fontSize(14)
      .fontColor('#FA8C16')
      .width('100%')
      .padding(12)
      .backgroundColor('#FFF7E6')
      .borderRadius(8)
  }

  @Builder
  BestPracticeCard() {
    Column({ space: 8 }) {
      Text('@Builder æœ€ä½³å®è·µ')
        .fontSize(14)
        .fontWeight(FontWeight.Medium)

      Text('â€¢ å…¨å±€ @Builderï¼šè·¨ç»„ä»¶å¤ç”¨')
        .fontSize(12)
        .fontColor('#666')

      Text('â€¢ å±€éƒ¨ @Builderï¼šç»„ä»¶å†…å¤ç”¨')
        .fontSize(12)
        .fontColor('#666')

      Text('â€¢ å‚æ•°åŒ–ï¼šæé«˜çµæ´»æ€§')
        .fontSize(12)
        .fontColor('#666')

      Text('â€¢ å‘½åè§„èŒƒï¼šæ¸…æ™°è¡¨è¾¾ç”¨é€”')
        .fontSize(12)
        .fontColor('#666')
    }
    .width('100%')
    .padding(12)
    .backgroundColor(Color.White)
    .borderRadius(8)
  }

  @Builder
  TipCard(tip: string) {
    Text(tip)
      .fontSize(12)
      .fontColor('#FF6B6B')
      .width('100%')
      .padding(12)
      .backgroundColor('#FFF5F5')
      .borderRadius(8)
      .margin({ top: 10 })
  }
}
