import router from '@ohos.router'

/**
 * è·¯ç”±ç›®æ ‡é¡µé¢
 * æ¥æ”¶å‚æ•°ã€å±•ç¤ºç”Ÿå‘½å‘¨æœŸ
 */

interface RouterParams {
  from?: string
  message?: string
  timestamp?: number
}

@Entry
@Component
struct RouterTargetPage {
  @State paramsFrom: string = 'æ— '
  @State message: string = 'æ— '
  @State timestamp: number = 0
  @State lifecycleLog: Array<string> = []

  build() {
    Column() {
      // é¡¶éƒ¨ä¿¡æ¯æ 
      Row() {
        Button('â† è¿”å›')
          .fontSize(14)
          .onClick(() => {
            router.back()
          })

        Text('ç›®æ ‡é¡µé¢')
          .fontSize(20)
          .fontWeight(FontWeight.Bold)
          .layoutWeight(1)
          .textAlign(TextAlign.Center)

        Button('è¿”å›é¦–é¡µ')
          .fontSize(14)
          .onClick(() => {
            router.pushUrl({
              url: 'pages/Index'
            })
          })
      }
      .width('100%')
      .padding({ left: 16, right: 16, top: 10, bottom: 10 })

      Scroll() {
        Column({ space: 16 }) {
          // æ¥æ”¶åˆ°çš„å‚æ•°
          Column({ space: 12 }) {
            Row() {
              Text('æ¥æ”¶åˆ°çš„å‚æ•°')
                .fontSize(18)
                .fontWeight(FontWeight.Bold)
                .layoutWeight(1)
            }
            .width('100%')

            Column({ space: 8 }) {
              this.ParamItem('æ¥æº', this.paramsFrom)
              this.ParamItem('æ¶ˆæ¯', this.message)
              this.ParamItem('æ—¶é—´æˆ³', this.timestamp > 0 ? new Date(this.timestamp).toLocaleString() : 'æ— ')
            }
            .width('100%')
          }
          .width('100%')
          .padding(16)
          .backgroundColor(Color.White)
          .borderRadius(12)

          // ç”Ÿå‘½å‘¨æœŸæ—¥å¿—
          Column({ space: 8 }) {
            Row() {
              Text('é¡µé¢ç”Ÿå‘½å‘¨æœŸæ—¥å¿—')
                .fontSize(16)
                .fontWeight(FontWeight.Bold)
                .layoutWeight(1)

              Button('æ¸…ç©º')
                .fontSize(12)
                .onClick(() => {
                  this.lifecycleLog = []
                })
            }
            .width('100%')

            List({ space: 4 }) {
              ForEach(this.lifecycleLog, (log: string) => {
                ListItem() {
                  Text(log)
                    .fontSize(12)
                    .fontColor('#666')
                }
              }, (log: string) => log)
            }
            .width('100%')
            .height(180)
            .padding(8)
            .backgroundColor('#F8F8F8')
            .borderRadius(8)
          }
          .width('100%')
          .padding(16)
          .backgroundColor(Color.White)
          .borderRadius(12)

          // ç”Ÿå‘½å‘¨æœŸè¯´æ˜
          Column({ space: 12 }) {
            Text('ç”Ÿå‘½å‘¨æœŸè¯´æ˜')
              .fontSize(18)
              .fontWeight(FontWeight.Bold)

            Column({ space: 8 }) {
              this.LifecycleItem('aboutToAppear', 'é¡µé¢åˆ›å»ºæ—¶è°ƒç”¨ï¼Œåˆå§‹åŒ–æ•°æ®')
              this.LifecycleItem('onPageShow', 'é¡µé¢æ˜¾ç¤ºæ—¶è°ƒç”¨ï¼Œæ¯æ¬¡åˆ‡å›å‰å°éƒ½ä¼šè§¦å‘')
              this.LifecycleItem('onPageHide', 'é¡µé¢éšè—æ—¶è°ƒç”¨ï¼Œåˆ‡åˆ°åå°æˆ–è·³è½¬æ–°é¡µé¢æ—¶è§¦å‘')
              this.LifecycleItem('aboutToDisappear', 'é¡µé¢é”€æ¯æ—¶è°ƒç”¨ï¼Œé‡Šæ”¾èµ„æº')
            }
            .width('100%')
          }
          .width('100%')
          .padding(16)
          .backgroundColor(Color.White)
          .borderRadius(12)

          // è·¯ç”±APIè¯´æ˜
          Column({ space: 12 }) {
            Text('å¸¸ç”¨è·¯ç”± API')
              .fontSize(18)
              .fontWeight(FontWeight.Bold)

            Column({ space: 8 }) {
              this.APIItem('pushUrl', 'è·³è½¬åˆ°æ–°é¡µé¢ï¼Œä¿ç•™å½“å‰é¡µé¢åœ¨æ ˆä¸­')
              this.APIItem('replaceUrl', 'æ›¿æ¢å½“å‰é¡µé¢ï¼Œä¸ä¿ç•™åœ¨æ ˆä¸­')
              this.APIItem('back', 'è¿”å›ä¸Šä¸€é¡µ')
              this.APIItem('getParams', 'è·å–è·¯ç”±ä¼ é€’çš„å‚æ•°')
              this.APIItem('getLength', 'è·å–é¡µé¢æ ˆæ•°é‡')
              this.APIItem('getState', 'è·å–é¡µé¢æ ˆçŠ¶æ€')
              this.APIItem('clear', 'æ¸…ç©ºé¡µé¢æ ˆ')
            }
            .width('100%')
          }
          .width('100%')
          .padding(16)
          .backgroundColor(Color.White)
          .borderRadius(12)

          // è·¯ç”±æ¨¡å¼è¯´æ˜
          Column({ space: 12 }) {
            Text('è·¯ç”±æ¨¡å¼è¯´æ˜')
              .fontSize(18)
              .fontWeight(FontWeight.Bold)

            Column({ space: 8 }) {
              this.ModeItem('Standard', 'æ ‡å‡†æ¨¡å¼ï¼Œé¡µé¢ä¼šå…¥æ ˆ')
              this.ModeItem('Single', 'å•å®ä¾‹æ¨¡å¼ï¼Œç›®æ ‡é¡µé¢åªæœ‰ä¸€ä¸ªå®ä¾‹')
            }
            .width('100%')
          }
          .width('100%')
          .padding(16)
          .backgroundColor(Color.White)
          .borderRadius(12)
        }
        .width('100%')
        .padding({ left: 16, right: 16, bottom: 20 })
      }
      .layoutWeight(1)
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#F5F5F5')
  }

  @Builder
  ParamItem(label: string, value: string) {
    Row() {
      Text(label)
        .fontSize(14)
        .fontColor('#666')
        .width(60)

      Text(value)
        .fontSize(14)
        .layoutWeight(1)
    }
    .width('100%')
    .padding(8)
    .backgroundColor('#F8F8F8')
    .borderRadius(6)
  }

  @Builder
  LifecycleItem(name: string, desc: string) {
    Column({ space: 4 }) {
      Text(name)
        .fontSize(14)
        .fontWeight(FontWeight.Medium)
        .fontColor('#007DFF')

      Text(desc)
        .fontSize(12)
        .fontColor('#666')
    }
    .alignItems(HorizontalAlign.Start)
    .width('100%')
    .padding(10)
    .backgroundColor('#F8F8F8')
    .borderRadius(6)
  }

  @Builder
  APIItem(name: string, desc: string) {
    Row({ space: 8 }) {
      Text(`router.${name}()`)
        .fontSize(13)
        .fontColor('#722ED1')
        .fontFamily('monospace')

      Text(desc)
        .fontSize(12)
        .fontColor('#666')
        .layoutWeight(1)
    }
    .width('100%')
  }

  @Builder
  ModeItem(name: string, desc: string) {
    Row({ space: 8 }) {
      Text(name)
        .fontSize(13)
        .fontWeight(FontWeight.Medium)
        .fontColor('#007DFF')

      Text(desc)
        .fontSize(12)
        .fontColor('#666')
        .layoutWeight(1)
    }
    .width('100%')
  }

  // æ·»åŠ æ—¥å¿—
  private addLog(message: string) {
    const time = new Date().toLocaleTimeString()
    this.lifecycleLog.unshift(`[${time}] ${message}`)
    if (this.lifecycleLog.length > 50) {
      this.lifecycleLog = this.lifecycleLog.slice(0, 50)
    }
  }

  // ==================== ç”Ÿå‘½å‘¨æœŸé’©å­ ====================
  aboutToAppear() {
    // è·å–ä¼ å…¥çš„å‚æ•°
    const params = router.getParams() as RouterParams
    if (params) {
      this.paramsFrom = params.from || 'æ— '
      this.message = params.message || 'æ— '
      this.timestamp = params.timestamp || 0
    }
    this.addLog('âœ… aboutToAppear - é¡µé¢åˆ›å»º')
  }

  aboutToDisappear() {
    this.addLog('âŒ aboutToDisappear - é¡µé¢é”€æ¯')
  }

  onPageShow() {
    this.addLog('ğŸ‘ï¸ onPageShow - é¡µé¢æ˜¾ç¤º')
  }

  onPageHide() {
    this.addLog('ğŸ™ˆ onPageHide - é¡µé¢éšè—')
  }
}
