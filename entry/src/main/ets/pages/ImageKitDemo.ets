import router from '@ohos.router'
import { image } from '@kit.ImageKit'

/**
 * Image Kit æ¼”ç¤º
 *
 * å±•ç¤ºå›¾ç‰‡åŠ è½½ã€ç¼“å­˜ã€å ä½å›¾ç­‰åŠŸèƒ½
 */

interface ImageItem {
  url: string
  name: string
  description: string
}

@Entry
@Component
struct ImageKitDemo {
  @State currentImageIndex: number = 0
  @State imageLoading: boolean = false
  @State showError: boolean = false
  @State selectedScale: number = 1

  // æœ¬åœ°å›¾ç‰‡ç¤ºä¾‹
  private localImages: Array<string> = [
    'app.media.app_icon',  // ä½¿ç”¨èµ„æº
    'app.media.app_icon',  // å¯ä»¥é‡å¤ä½¿ç”¨
  ]

  // ç½‘ç»œå›¾ç‰‡åˆ—è¡¨
  private networkImages: Array<ImageItem> = [
    {
      url: 'https://img.yzcdn.cn/iconv2/157588/pic.go.png',
      name: 'å¤´åƒå ä½å›¾',
      description: 'ç”¨æˆ·é»˜è®¤å¤´åƒ'
    },
    {
      url: 'https://img.yzcdn.cn/iconv2/157588/pic.go.png',
      name: 'ç¤ºä¾‹å›¾ç‰‡1',
      description: 'é£æ™¯å›¾ç‰‡'
    }
  ]

  // å¸¸ç”¨ç½‘ç»œå›¾ç‰‡URLï¼ˆå®é™…å¼€å‘æ—¶ä½¿ç”¨çœŸå®åœ°å€ï¼‰
  private sampleUrls: Array<string> = [
    'https://example.com/image1.jpg',
    'https://example.com/image2.jpg'
  ]

  build() {
    Scroll() {
      Column({ space: 16 }) {
        // è¿”å›æŒ‰é’®
        this.BackButton()

        // æ ‡é¢˜
        this.SectionTitle('Image Kit - å›¾ç‰‡æœåŠ¡')

        // è¯´æ˜å¡ç‰‡
        this.InfoCard('Image Kit æä¾›å›¾ç‰‡åŠ è½½ã€ç¼“å­˜ã€å ä½å›¾ç­‰åŠŸèƒ½')

        // ç¤ºä¾‹1ï¼šåŸºç¡€å›¾ç‰‡åŠ è½½
        this.BasicImageSection()

        // ç¤ºä¾‹2ï¼šç½‘ç»œå›¾ç‰‡
        this.NetworkImageSection()

        // ç¤ºä¾‹3ï¼šå ä½å›¾
        this.PlaceholderSection()

        // ç¤ºä¾‹4ï¼šå›¾ç‰‡ç¼“å­˜
        this.CacheSection()

        // ç¤ºä¾‹5ï¼šå›¾ç‰‡ç¼©æ”¾
        this.ScaleSection()

        // ç¤ºä¾‹6ï¼šSVGå›¾ç‰‡
        this.SVGSection()

        // APIè¯´æ˜
        this.APISection()

        this.TipCard('ğŸ’¡ æç¤ºï¼šå®é™…å¼€å‘ä¸­ä½¿ç”¨çœŸå®å›¾ç‰‡URL')
      }
      .width('100%')
      .padding({ left: 16, right: 16, top: 20, bottom: 20 })
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#F5F5F5')
  }

  @Builder
  BackButton() {
    Row() {
      Button('â† è¿”å›')
        .fontSize(14)
        .onClick(() => {
          router.back()
        })
    }
    .width('100%')
    .margin({ bottom: 10 })
  }

  @Builder
  SectionTitle(title: string) {
    Text(title)
      .fontSize(24)
      .fontWeight(FontWeight.Bold)
      .width('100%')
  }

  @Builder
  InfoCard(info: string) {
    Text(info)
      .fontSize(14)
      .fontColor('#13C2C2')
      .width('100%')
      .padding(12)
      .backgroundColor('#E6FFFE')
      .borderRadius(8)
  }

  @Builder
  BasicImageSection() {
    Column({ space: 12 }) {
      Text('ç¤ºä¾‹1ï¼šåŸºç¡€å›¾ç‰‡åŠ è½½')
        .fontSize(16)
        .fontWeight(FontWeight.Bold)

      Column({ space: 12 }) {
        // æœ¬åœ°å›¾ç‰‡
        Column({ space: 8 }) {
          Text('æœ¬åœ°èµ„æºå›¾ç‰‡')
            .fontSize(14)
            .fontColor('#666')

          Row({ space: 12 }) {
            Image($r('app.media.app_icon'))
              .width(80)
              .height(80)
              .borderRadius(8)
              .objectFit(ImageFit.Cover)

            Column({ space: 4 }) {
              Text('app.media.app_icon')
                .fontSize(12)
                .fontFamily('monospace')
                .fontColor('#999')

              Text('ä»èµ„æºç›®å½•åŠ è½½')
                .fontSize(11)
                .fontColor('#666')
            }
          }
        }
      }
    }
    .width('100%')
    .padding(16)
    .backgroundColor(Color.White)
    .borderRadius(12)
  }

  @Builder
  NetworkImageSection() {
    Column({ space: 12 }) {
      Text('ç¤ºä¾‹2ï¼šç½‘ç»œå›¾ç‰‡åŠ è½½')
        .fontSize(16)
        .fontWeight(FontWeight.Bold)

      Column({ space: 12 }) {
        // å•å¼ å›¾ç‰‡
        Column({ space: 8 }) {
          Text('å•å¼ ç½‘ç»œå›¾ç‰‡')
            .fontSize(14)
            .fontColor('#666')

          if (this.imageLoading) {
            Row({ space: 8 }) {
              LoadingProgress()
                .width(20)
                .height(20)
                .color('#007DFF')

              Text('åŠ è½½ä¸­...')
                .fontSize(14)
                .fontColor('#666')
            }
            .justifyContent(FlexAlign.Center)
          }

          Image('https://img.yzcdn.cn/iconv2/157588/pic.go.png')
            .width(120)
            .height(120)
            .borderRadius(8)
            .objectFit(ImageFit.Cover)
            .onStart(() => {
              this.imageLoading = true
              this.showError = false
            })
            .onComplete(() => {
              this.imageLoading = false
            })
            .onError(() => {
              this.imageLoading = false
              this.showError = true
            })
            .onError((errorArgs: Record<string, string>) => {
              console.error('å›¾ç‰‡åŠ è½½å¤±è´¥:', JSON.stringify(errorArgs))
            })

          if (this.showError) {
            Text('å›¾ç‰‡åŠ è½½å¤±è´¥')
              .fontSize(12)
              .fontColor('#FF6B6B')
              .margin({ top: 8 })
          }
        }
      }
    }
    .width('100%')
    .padding(16)
    .backgroundColor(Color.White)
    .borderRadius(12)
  }

  @Builder
  PlaceholderSection() {
    Column({ space: 12 }) {
      Text('ç¤ºä¾‹3ï¼šå ä½å›¾è®¾ç½®')
        .fontSize(16)
        .fontWeight(FontWeight.Bold)

      Column({ space: 12 }) {
        Column({ space: 8 }) {
          Row({ space: 12 }) {
            Column({ space: 4 }) {
              Text('é»˜è®¤å ä½å›¾')
                .fontSize(14)
                .fontColor('#666')

              Text('åŠ è½½å‰æ˜¾ç¤ºçš„å›¾ç‰‡')
                .fontSize(11)
                .fontColor('#999')
            }
            .layoutWeight(1)

            Image('https://img.yzcdn.cn/iconv2/157588/pic.go.png')
              .width(100)
              .height(100)
              .borderRadius(8)
              .objectFit(ImageFit.Cover)
              .alt('é»˜è®¤å ä½å›¾')
              .onError(() => {
                // å ä½å›¾åŠ è½½å¤±è´¥æ—¶çš„å¤„ç†
              })
          }

          Row({ space: 12 }) {
            Column({ space: 4 }) {
              Text('åŠ è½½å¤±è´¥å ä½å›¾')
                .fontSize(14)
                .fontColor('#666')

              Text('ç½‘ç»œå›¾ç‰‡åŠ è½½å¤±è´¥æ—¶æ˜¾ç¤º')
                .fontSize(11)
                .fontColor('#999')
            }
            .layoutWeight(1)

            Image('https://img.yzcdn.cn/iconv2/157588/pic.go.png')
              .width(100)
              .height(100)
              .borderRadius(8)
              .objectFit(ImageFit.Cover)
              .alt('é”™è¯¯å ä½å›¾')
              .onError(() => {
                // è¿™é‡Œç”¨é”™è¯¯å›¾ç‰‡æ›¿æ¢
              })
          }
        }
      }
    }
    .width('100%')
    .padding(16)
    .backgroundColor(Color.White)
    .borderRadius(12)
  }

  @Builder
  CacheSection() {
    Column({ space: 12 }) {
      Text('ç¤ºä¾‹4ï¼šå›¾ç‰‡ç¼“å­˜è¯´æ˜')
        .fontSize(16)
        .fontWeight(FontWeight.Bold)

      Column({ space: 8 }) {
        this.CacheItem(
          'å†…å­˜ç¼“å­˜',
          'å·²è§£ç çš„å›¾ç‰‡ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œä¸‹æ¬¡è®¿é—®æ›´å¿«',
          '#52C41A'
        )

        this.CacheItem(
          'ç£ç›˜ç¼“å­˜',
          'å›¾ç‰‡æ–‡ä»¶ç¼“å­˜åœ¨æœ¬åœ°ï¼Œé¿å…é‡å¤ä¸‹è½½',
          '#007DFF'
        )

        this.CacheItem(
          'è‡ªåŠ¨æ¸…ç†',
          'ç³»ç»Ÿä¼šè‡ªåŠ¨ç®¡ç†ç¼“å­˜å¤§å°',
          '#FA8C16'
        )
      }
    }
    .width('100%')
    .padding(16)
    .backgroundColor(Color.White)
    .borderRadius(12)
  }

  @Builder
  CacheItem(title: string, desc: string, color: string) {
    Row({ space: 12 }) {
      Column({ space: 4 }) {
        Text(title)
          .fontSize(14)
          .fontWeight(FontWeight.Medium)
          .fontColor(color)

        Text(desc)
          .fontSize(12)
          .fontColor('#666')
      }
    }
    .layoutWeight(1)
  }

  @Builder
  ScaleSection() {
    Column({ space: 12 }) {
      Text('ç¤ºä¾‹5ï¼šå›¾ç‰‡ç¼©æ”¾æ¨¡å¼')
        .fontSize(16)
        .fontWeight(FontWeight.Bold)

      Column({ space: 12 }) {
        Row({ space: 8 }) {
          Column({ space: 6 }) {
            Text('Cover')
              .fontSize(13)
              .fontColor('#666')

            Image('https://img.yzcdn.cn/iconv2/157588/pic.go.png')
              .width(100)
              .height(80)
              .objectFit(ImageFit.Cover)
              .border({ width: 2, color: '#E6E6E6' })
          }

          Column({ space: 6 }) {
            Text('Contain')
              .fontSize(13)
              .fontColor('#666')

            Image('https://img.yzcdn.cn/iconv2/157588/pic.go.png')
              .width(100)
              .height(80)
              .objectFit(ImageFit.Contain)
              .border({ width: 2, color: '#E6E6E6' })
          }

          Column({ space: 6 }) {
            Text('Fill')
              .fontSize(13)
              .fontColor('#666')

            Image('https://img.yzcdn.cn/iconv2/157588/pic.go.png')
              .width(100)
              .height(80)
              .objectFit(ImageFit.Fill)
              .border({ width: 2, color: '#E6E6E6' })
          }
        }

        Row({ space: 8 }) {
          Column({ space: 6 }) {
            Text('None')
              .fontSize(13)
              .fontColor('#666')

            Image('https://img.yzcdn.cn/iconv2/157588/pic.go.png')
              .width(100)
              .height(80)
              .objectFit(ImageFit.None)
              .border({ width: 2, color: '#E6E6E6' })
          }

          Column({ space: 6 }) {
            Text('ScaleDown')
              .fontSize(13)
              .fontColor('#666')

            Image('https://img.yzcdn.cn/iconv2/157588/pic.go.png')
              .width(100)
              .height(80)
              .objectFit(ImageFit.ScaleDown)
              .border({ width: 2, color: '#E6E6E6' })
          }
        }
      }

      Text('objectFit å‚æ•°è¯´æ˜')
        .fontSize(12)
        .fontColor('#999')
        .width('100%')
        .textAlign(TextAlign.Center)
        .margin({ top: 8 })
    }
    .width('100%')
    .padding(16)
    .backgroundColor(Color.White)
    .borderRadius(12)
  }

  @Builder
  SVGSection() {
    Column({ space: 12 }) {
      Text('ç¤ºä¾‹6ï¼šSVG å›¾ç‰‡æ”¯æŒ')
        .fontSize(16)
        .fontWeight(FontWeight.Bold)

      Column({ space: 8 }) {
        Text('SVG çŸ¢é‡å›¾æ ‡')
          .fontSize(14)
          .fontColor('#666')

        Row({ space: 12 }) {
          Column({ space: 4 }) {
            Text('SVG å›¾æ ‡')
              .fontSize(12)
              .fontColor('#999')

            Text('æ¨èä½¿ç”¨ SVGï¼Œä»»æ„ç¼©æ”¾ä¸å¤±çœŸ')
              .fontSize(11)
              .fontColor('#666')
          }

          Image($r('sys.symbol.ohos_ic_public_phone'))
            .width(60)
            .height(60)
            .fillColor('#007DFF')
        }
      }
    }
    .width('100%')
    .padding(16)
    .backgroundColor(Color.White)
    .borderRadius(12)
  }

  @Builder
  APISection() {
    Column({ space: 12 }) {
      Text('å¸¸ç”¨ API è¯´æ˜')
        .fontSize(16)
        .fontWeight(FontWeight.Bold)

      Column({ space: 8 }) {
        this.APIItem('onStart()', 'å›¾ç‰‡å¼€å§‹åŠ è½½')
        this.APIItem('onComplete()', 'å›¾ç‰‡åŠ è½½å®Œæˆ')
        this.APIItem('onError()', 'å›¾ç‰‡åŠ è½½å¤±è´¥')
        this.APIItem('onSuccess()', 'å›¾ç‰‡åŠ è½½æˆåŠŸï¼ˆéƒ¨åˆ†åœºæ™¯ï¼‰')
        this.APIItem('objectFit', 'å›¾ç‰‡ç¼©æ”¾æ¨¡å¼ï¼šCover/Contain/Fill/None/ScaleDown')
        this.APIItem('alt', 'å ä½æ–‡æœ¬æˆ–å ä½å›¾ç‰‡èµ„æº')
      }
    }
    .width('100%')
    .padding(16)
    .backgroundColor(Color.White)
    .borderRadius(12)
  }

  @Builder
  APIItem(name: string, desc: string) {
    Row({ space: 8 }) {
      Text(name)
        .fontSize(13)
        .fontFamily('monospace')
        .fontColor('#722ED1')
        .width(140)

      Text(desc)
        .fontSize(12)
        .fontColor('#666')
        .layoutWeight(1)
    }
    .width('100%')
  }

  @Builder
  TipCard(tip: string) {
    Text(tip)
      .fontSize(12)
      .fontColor('#FA8C16')
      .width('100%')
      .padding(12)
      .backgroundColor('#FFF7E6')
      .borderRadius(8)
      .margin({ top: 10 })
  }
}
